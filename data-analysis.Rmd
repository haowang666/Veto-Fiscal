---
title: "Data Analysis"
author: "Hao Wang"
date: '`r format(Sys.Date(), "%B %d, %Y")`'
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load Merged Data and Clean it

```{r, echo=FALSE}
library(MASS)
library(dplyr)
library(ggplot2)
mydata <- read.csv("https://raw.githubusercontent.com/haowang666/Veto-Fiscal/master/vdem-merge.csv?token=AX7YEY61G5zquz7jnDfL0Sl5k-3Bw8upks5Y9BGxwA%3D%3D")

```


```{r, echo=FALSE, include=FALSE}
names(mydata)
summary(mydata) #tons of missing data
```


# Get ready for the dependent variables:

I measure the budget stability as the simple euclidean distance of the between-year percentage differences. It can be written in the following equation: $S_t$ is the stability index of a certain year $t$. Since government budget has various categories: $p_{it}$ denotes the percentage of $i$th category of total expenditure. $S_t$ will increase as the difference between $p_{it}$ and $p_{it-1}$ increases. 

$$S_t = \sqrt{\sum_{i = 1}^i (p_{it} -p_{it-1})^2} ~~~~~~~~~~~~~~~~~~~~ (1)$$ 

```{r generate DV, echo=FALSE, message=FALSE}
#Too many missings, gonna do multiple imputation
set.seed(1)
library(Amelia)
#create lagged variables
library(dplyr)
mydata <- 
    mydata %>%
    group_by(cowcode) %>%
    mutate(lag.expend_security_EXP = lag(expend_security_EXP, 1), 
           lag.expenddefence_EXP = lag(expenddefence_EXP, 1),
           lag.exp_public_order_EXP = lag(exp_public_order_EXP, 1), 
           lag.wagessalaries_EXP = lag(wagessalaries_EXP, 1), 
           lag.pensions_EXP = lag(pensions_EXP, 1), 
           lag.total_welfare_EXP = lag(total_welfare_EXP, 1), 
           lag.education_EXP = lag(education_EXP, 1), 
           lag.health_EXP = lag(health_EXP, 1),
           lag.social_protection_EXP = lag(social_protection_EXP, 1),
           lag.housing_EXP = lag(housing_EXP, 1), 
           lag.owelfarespend_EXP = lag(owelfarespend_EXP, 1))

a.out <- amelia(mydata, ts= "year", cs="country", 
                idvars = c("X", "cowcode"), m=5)


missmap(a.out)
impute1 <- a.out$imputations[[1]]
write.amelia(obj = a.out, file.stem = impute, separate = TRUE, format = "csv")





mydata1 <- mydata[c("country", "year", "expend_security_EXP", "expenddefence_EXP",
                   "exp_public_order_EXP", "wagessalaries_EXP", 
                   "pensions_EXP", "total_welfare_EXP", "education_EXP", 
                   "health_EXP", "social_protection_EXP", "housing_EXP", "owelfarespend_EXP")]

#Pick remaining data
myvars <- names(mydata) %in% c("country", "year", "expend_security_EXP", "expenddefence_EXP",
                   "exp_public_order_EXP", "wagessalaries_EXP", 
                   "pensions_EXP", "total_welfare_EXP", "education_EXP", 
                   "health_EXP", "social_protection_EXP", "housing_EXP", "owelfarespend_EXP")
mydata2 <- mydata[!myvars]

attach(mydata)
mydata$S <- sqrt((expend_security_EXP - lag.expend_security_EXP)^2 +
                   (lag.expenddefence_EXP - expenddefence_EXP)^2 +
                   (lag.exp_public_order_EXP - exp_public_order_EXP)^2 +
                   (lag.wagessalaries_EXP - wagessalaries_EXP)^2)






```

